<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/livestorm/livestorm-plugin/dist/assets/css/style.css"
/>

<section style="width: max-content; height: 100px">
  <div class="ls-grid ls-mt-4">
    <div class="ls-row ls-py-1">
      <div class="ls-px-1 ls-column">
        <div id="countdownTitle" class="ls-warning-message ls-warning-info">
          <p class="ls-text-24-semibold">{{itemNumber}}</p>
        </div>
      </div>
      <div class="ls-px-1 ls-column">
        <div id="countdownTitle" class="ls-warning-message ls-warning-success">
          <p class="ls-text-24-semibold">{{title}}</p>
        </div>
      </div>
      <div class="ls-px-1 ls-column">
        <div id="countdownTimer" class="ls-warning-message ls-warning-success">
          <p class="ls-text-24-semibold" id="countdown">loading...</p>
        </div>
      </div>
      <div class="ls-px-1 ls-pt-3 ls-column">
        <button
          class="ls-button ls-button-primary ls-float-right"
          onclick="onNextItem()"
        >
          <div class="ls-button-wrapper">Next Item</div>
        </button>
      </div>
    </div>
  </div>
</section>

<script>
  const countDownDate = new Date(
    new Date().getTime() + `{{timeInMinutes}}` * 60000
  ).getTime();
  const onNextItem = () => {
    postMessage("none");
    closeModal();
  };

  var x = setInterval(function () {
    var now = new Date().getTime();

    var distance = countDownDate - now;
    var hours = Math.floor(
      (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    );
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

    const countdownTimer = document.getElementById("countdownTimer");
    const countdownTitle = document.getElementById("countdownTitle");

    if (hours === 0 && minutes === 1 && seconds == 0) {
      countdownTimer.style.color = "orange";
      countdownTitle.style.color = "orange";

      countdownTimer.classList.remove("ls-warning-success");
      countdownTimer.classList.add("ls-warning-warning");
      countdownTitle.classList.remove("ls-warning-success");
      countdownTitle.classList.add("ls-warning-warning");
    }

    if (distance <= 0) {
      countdownTimer.style.color = "red";
      countdownTitle.style.color = "red";

      countdownTimer.classList.remove("ls-warning-warning");
      countdownTimer.classList.add("ls-warning-error");
      countdownTitle.classList.remove("ls-warning-warning");
      countdownTitle.classList.add("ls-warning-error");
    }

    document.getElementById("countdown").innerHTML = `${
      hours ? hours + "h " : ""
    }${minutes ? minutes + "m " : ""} ${seconds + "s"}`;

    if (distance < 0) {
      clearInterval(x);
      document.getElementById("countdown").innerHTML = "TIME IS UP!!";
    }
  }, 1000);
</script>
